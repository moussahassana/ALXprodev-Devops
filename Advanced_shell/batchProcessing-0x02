#!/bin/bash

# Create directory for saving data
mkdir -p pokemon_data
mkdir -p logs

# List of Pokémon to fetch
pokemon_list=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# Base API URL
base_url="https://pokeapi.co/api/v2/pokemon"

# Log file for failures
error_log="logs/fetch_errors.log"
> "$error_log"  # Clear previous log

# Loop through Pokémon list
for name in "${pokemon_list[@]}"; do
    echo "Fetching data for $name..."

    success=false
    attempts=0

    while [ "$success" = false ] && [ $attempts -lt 3 ]; do
        # Try fetching data
        curl -s --fail "$base_url/$name" -o "pokemon_data/${name}.json"

        if [ $? -eq 0 ]; then
            echo "Saved data to pokemon_data/${name}.json"
            success=true
        else
            attempts=$((attempts + 1))
            echo "Attempt $attempts failed for $name..."
            sleep 1
        fi
    done

    # After 3 failed attempts
    if [ "$success" = false ]; then
        echo "Failed to fetch data for $name after 3 attempts" | tee -a "$error_log"
    fi

    # Respect API rate limits
    sleep 1
done
